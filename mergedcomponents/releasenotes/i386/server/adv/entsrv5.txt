**********************************************************************
               Windows Server 2003, Enterprise Edition
                    Setup Text Files, Part 5 of 6:
              Upgrading and Installing on Cluster Nodes

**********************************************************************
 

This part of the text file series provides information about upgrading
and installing on cluster nodes. With Microsoft Windows
Server 2003, Enterprise Edition, and Microsoft Windows
Server 2003, Datacenter Edition, you can use clustering to ensure
that users have constant access to important server-based resources.
With clustering, you create several cluster nodes that appear to users
as one server. If one of the nodes in the cluster fails, another node
begins to provide service (a process known as failover). Critical
applications and resources remain continuously available.

The following list of headings can help you find the information
about server clusters that applies to you. For information about basic
planning for an upgrade or a new installation, see EntSrv1.TXT,
EntSrv2.TXT, and EntSrv3.TXT. For information about running Setup,
see EntSrv4.TXT.

In EntSrv5.TXT:
---------------
     1.0    Preparing for Upgrading Clustering
     2.0    Upgrading a Cluster from Windows 2000 to Windows
            Server 2003, Enterprise Edition
     3.0    Upgrading a Cluster from Windows NT Server 4.0 to
            Windows Server 2003, Enterprise Edition
        3.1 Upgrading from Windows NT Server 4.0 While Not
            Maintaining Cluster Availability

In EntSrv6.TXT:
---------------
     Section 3 cont'd.
        3.2 Upgrades from Windows NT 4.0 that Include an IIS Resource
     4.0    Installing on Cluster Nodes
     5.0    Planning and Preparing for Cluster Installation
     6.0    Beginning the Cluster Installation on the First Cluster
            Node


======================================================================
1.0   PREPARING FOR UPGRADING CLUSTERING
======================================================================


The following sections provide information on the initial steps
needed for upgrading clustering:

   * Understanding the basic preparations needed.

   * Confirming your hardware compatibility with Windows
     Server 2003, Enterprise Edition.

   * Choosing from the available options for upgrading.


----------------------------------
1.1   Other Sources of Information
----------------------------------
Following are sources of additional information on server clusters
and other topics related to high availability:

* For more information on server clusters, you can view Help and
  Support Center topics for Windows Server 2003, Enterprise
  Edition, on the Web at:

     http://www.microsoft.com/windowsserver2003/proddoc/

  Another way to view this information is to open Help and Support
  Center. To do this, after running Setup, click Start, and then
  click Help and Support.

* For more information about deployment and management of servers
  and server clusters, see the Windows Deployment and Resource Kits
  on the Web at:

     http://www.microsoft.com/reskit/

* For information about backup and recovery planning, change
  management, configuration management, and other concepts related
  to operational best practices, see resources in the Information
  Technology Infrastructure Library (ITIL). To see a description of
  ITIL, go to:
 
     http://www.itil.co.uk/

  Note: Web addresses can change, so you might be unable to connect to
  the Web site mentioned here.


----------------------------
1.2   Hardware Compatibility
----------------------------
Ensure that your entire cluster solution (including your drivers as
well as your hardware) is compatible with products in the
Windows Server 2003 family by checking the hardware compatibility
information in the Windows Catalog at:

   http://www.microsoft.com/windows/catalog/


--------------------------------------
1.3   Options for Upgrading Clustering
--------------------------------------
You have several options when upgrading clustering. You can:

* Upgrade the operating system on a cluster that is running Microsoft
  Windows NT Server 4.0, Enterprise Edition. For a description
  of the ways you can do this, see "Upgrading a Cluster from
  Windows NT Server 4.0 to Windows Server 2003,
  Enterprise Edition," later in this text file.

* Upgrade a cluster that is running Microsoft Windows 2000, possibly
  through a rolling upgrade. For more information, see "Upgrading
  a Cluster from Windows 2000 to Windows Server 2003,
  Enterprise Edition," later in this text file.

* Perform a new installation of Windows Server 2003,
  Enterprise Edition, and install the Cluster service at the same
  time. For more information about this option, see "Installing on
  Cluster Nodes" in EntSrv6.TXT.


-----------------------------
1.4   Quorum Resource Options
-----------------------------
With clusters running on Windows Server 2003, Enterprise
Edition, you can choose between three ways to set up the quorum
resource (the resource that maintains the definitive copy of the
cluster configuration data and that must always be available for the
cluster to run). These options are:

   * Single node server cluster

   * Single quorum device server cluster

   * Majority node set

Before upgrading, refer to "Quorum Resource Options" in EntSrv6.TXT
to learn more about these options.


======================================================================
2.0   UPGRADING A CLUSTER FROM WINDOWS 2000 TO WINDOWS
      SERVER 2003, ENTERPRISE EDITION
======================================================================


If you are upgrading from Windows 2000 to Windows Server 2003,
Enterprise Edition, on cluster nodes, you might be able to perform a
rolling upgrade of the operating system. In a rolling upgrade, you
sequentially upgrade the operating system on each node, making sure
that one node is always available to handle client requests. When you
upgrade the operating system, the Cluster service is automatically
upgraded also. A rolling upgrade maximizes availability of clustered
services and minimizes administrative complexity. For more
information, see the next section, "How Rolling Upgrades Work."

To determine whether you can perform a rolling upgrade, and
understand the effect that a rolling upgrade might have on your
clustered resources, see "Restrictions on Rolling Upgrades" later in
this text file. For information about ways to upgrade your cluster
nodes if you cannot perform a rolling upgrade, see "Alternatives to
Rolling Upgrades from Windows 2000" later in this text file.


-------------------------------
2.1   How Rolling Upgrades Work
-------------------------------
This section describes rolling upgrades on server clusters. For
information about methods, restrictions, and alternatives to rolling
upgrades, see the sections that follow this section.

There are two major advantages to a rolling upgrade. First, there is
a minimal interruption of service to clients. (However, server
response time might decrease during the phases in which a fewer number
of nodes handle the work of the entire cluster.) Second, you do not
have to recreate your cluster configuration. The configuration remains
intact during the upgrade process.


2.1.1  Phases of a Rolling Upgrade
----------------------------------
A rolling upgrade starts with two cluster nodes that are running
Windows 2000. In this example, they are named Node 1 and Node 2:

Phase 1: Preliminary
--------------------
Each node runs Windows 2000 Advanced Server with the
following software:

   * The Cluster service component (one of the optional components of
     Windows 2000 Advanced Server).

   * Applications that support a rolling upgrade. For more
     information, see the application documentation, and "Resource
     Behavior During Rolling Upgrades" later in this text file.

At this point, your cluster is configured so that each node handles
client requests (an active/active configuration).

Phase 2: Upgrade Node 1
-----------------------
Node 1 is paused, and Node 2 handles all cluster resource groups
while you upgrade the operating system of Node 1 to Windows
Server 2003, Enterprise Edition.

You are now running a mixed-version cluster. A mixed-version cluster
is a cluster in which the nodes are running different versions of the
operating system. Although mixed-version clusters are supported by
Windows Server 2003, Enterprise Edition, they are not the optimal
configuration. It is recommended that you upgrade all nodes to the
same operating system by completing the final two phases of the
rolling upgrade.

When your cluster is in a mixed version state, it is recommended that
you do not make any changes to the cluster configuration, such as
adding or removing nodes. It is also recommended that you do not make
changes to any of the cluster resources while your cluster is in a
mixed version state.

Phase 3: Upgrade Node 2
-----------------------
Node 1 rejoins the cluster. Node 2 is paused and Node 1 handles all
cluster resource groups while you upgrade the operating system on
Node 2.

Phase 4: Final
--------------
Node 2 rejoins the cluster, and you redistribute the resource groups
back to the active/active cluster configuration.

   IMPORTANT: If your goal is to have more than two nodes in the
   cluster, you must use Fibre Channel (not SCSI) for the cluster
   storage. Add the additional nodes after completing the rolling
   upgrade. Before adding additional nodes, ensure that your entire
   cluster solution is compatible with products in the Windows
   Server 2003 family. For cluster disks, you must use the NTFS file
   system and configure the disks as basic disks. You cannot configure
   cluster disks as dynamic disks, and you cannot use features of
   dynamic disks such as spanned volumes (volume sets).


2.1.2  Performing a Rolling Upgrade
-----------------------------------
For an outline of the rolling upgrade process, see the preceding
section "How Rolling Upgrades Work."

Group Membership Requirements for Cluster Upgrade Procedures
------------------------------------------------------------
To perform any of the cluster upgrade procedures in this text file,
you must be a member of the Administrators group on the local
computer, or you must have been delegated the appropriate authority.
If the computer is joined to a domain, members of the Domain Admins
group might be able to perform these procedures. As a security best
practice, consider using Run as to perform upgrade procedures. Run as
is a secondary logon method that you can use to start commands or
programs using a different security context. For example, you can log
on as a member of the Users group and, without logging off, run a
command as a member of the Administrators group. To find more
information in Windows 2000 about Run as, on a server running
Windows 2000, click Start, click Help, click the Search tab and then
search for "runas."

   IMPORTANT: For information about what resources are supported
   during rolling upgrades, see "Restrictions on Rolling Upgrades"
   and "Resource Behavior During Rolling Upgrades" later in this
   text file.

>>>TO PERFORM A ROLLING UPGRADE FROM WINDOWS 2000

   1. Confirm that your systems are running Windows 2000 and use
      resources that are supported during a rolling upgrade, as
      described in "Restrictions on Rolling Upgrades" and "Resource
      Behavior During Rolling Upgrades" later in this text file.

   2. Confirm that your hardware is designed for or is compatible
      with Windows Server 2003, Enterprise Edition.

   3. In Cluster Administrator, click the node that you want to
      upgrade first.

   4. On the File menu, click Pause Node.

   5. In the details pane, click Active Groups.

   6. In the details pane, click a group, and then on the File menu,
      click Move Group. Repeat this step for each group listed.

      The services will be interrupted during the time they are being
      moved and restarted on the other node. After the groups are
      moved, one node is idle, and the other node handles all
      client requests.

   7. Use Setup for Windows Server 2003, Enterprise Edition, to
      upgrade the paused node from Windows 2000. (For information
      about running Setup, see EntSrv4.TXT.)

      Setup detects the earlier version of clustering on the paused
      node and automatically installs clustering for
      Windows Server 2003, Enterprise Edition. The node
      automatically rejoins the cluster at the end of the upgrade
      process, but is still paused and does not handle any
      cluster-related work.

         Note: As you begin the setup process, you will receive a
         warning message about using the tempdrive option for Setup.
         Provided you have followed the preceding steps, you can click
         OK and proceed with Setup without using this option.

   8. Manage Your Server will appear when you initially log on to the
      newly upgraded node as an Administrator. Close Manage Your
      Server to continue with the upgrade.

   9. To verify that the node that was upgraded is fully functional,
      perform validation tests such as confirming that the operating
      system recognizes your network connections and, using Device
      Manager, ensuring that the operating system recognizes all of
      your storage devices.

  10. In Cluster Administrator, click the node that was paused, and
      then on the File menu click Resume Node.

         Note: When you use Cluster Administrator for the first time
         on the upgraded node, Cluster Administrator will prompt you
         to "Open connection to cluster." In the "Cluster or server
         name" field, type a period (.). This will connect you to the
         cluster on the local upgraded node. Although you can connect
         to the cluster by typing the cluster name, if you do so you
         will be connected to the cluster on the Windows 2000 node
         and then will be required to respond to several
         warning messages.

  11. Repeat the preceding steps for the remaining node.


--------------------------------------
2.2   Restrictions on Rolling Upgrades
--------------------------------------
There are several basic restrictions to the rolling-upgrade process.
The most basic restrictions are as follows:

* You can perform a rolling upgrade only if you are upgrading from
  Windows 2000 on the cluster nodes. You cannot perform a rolling
  upgrade if you are upgrading from Windows NT Server 4.0,
  Enterprise Edition. For a description of the ways to upgrade from
  Windows NT Server 4.0, see "Upgrading a Cluster from Windows NT
  Server 4.0 to Windows Server 2003, Enterprise Edition,"
  later in this text file.

* You cannot mix x86-based and Itanium architecture-based computers
  within the same cluster. Therefore you cannot perform a rolling
  upgrade from an x86-based computer to an Itanium
  architecture-based computer.

The remaining restrictions involve the beginning of Phase 3, in which
you operate a mixed-version cluster: a cluster in which the nodes run
different versions of the operating system. The operation of a
mixed-version cluster is complicated if a resource type that you add
to the cluster is supported in one version of the operating system but
not the other. For example, the Cluster service in Windows 
Server 2003, Enterprise Edition, supports the Generic Script resource
type. However, older versions of the Cluster service do not
support it.

A mixed-version cluster can run a Generic Script resource on a node
running Windows Server 2003, Enterprise Edition, but not on a
node running Windows 2000. The Cluster service transparently sets the
possible owners of new resource types to prevent these resources from
failing over to a Windows 2000 node of a mixed-version cluster. In
other words, when you view the possible owners of a new resource type,
a Windows 2000 node will not be in the list, and you will not be able
to add this node to the list. If you create such a resource during the
mixed-version phase of a rolling upgrade, the resource groups
containing those resources will not fail over to a Windows 2000 node.

In order for a mixed-version cluster to work, the different versions
of the software running on each node must be prepared to communicate
with one another. This requirement leads to several basic restrictions
on the rolling-upgrade process.

* For a successful rolling upgrade, every resource that the cluster
  manages must be capable of a rolling upgrade. For more
  information, see "Resource Behavior During Rolling Upgrades"
  later in this text file.

* During the mixed-version phase of a rolling upgrade, when the
  cluster nodes are running different versions of the operating
  system, do not change the settings of resources (for example, do
  not change the settings of a printer resource).

If the preceding restriction cannot be met, do not perform a rolling
upgrade. For more information, see "Alternatives to Rolling Upgrades
from Windows 2000" later in this text file.


-----------------------------------------------
2.3   Resource Behavior During Rolling Upgrades
-----------------------------------------------
Although the Cluster service supports rolling upgrades, not all
applications have seamless rolling-upgrade behavior. The following
table describes the resources that are supported during a rolling
upgrade. If you have a resource that is not fully supported during
rolling upgrades, see "Alternatives to Rolling Upgrades from
Windows 2000" later in this text file.


======================================================================
RESOURCE           ROLLING UPGRADE NOTES
----------------------------------------------------------------------
DHCP               DHCP is not fully supported during rolling
                   upgrades. You must instead perform a "Last node
                   rolling upgrade" as described in "Alternatives
                   to Rolling Upgrades from Windows 2000" later in
                   this text file.

File Share         Supported during rolling upgrades.

IIS                IIS 6.0 is not supported during a rolling upgrade.
                   When upgrading a cluster that contains an IIS
                   resource, you must follow the procedure
                   described in "Upgrades That Include an IIS
                   Resource" later in this text file.

IP Address         Supported during rolling upgrades.

Local Quorum       Supported during rolling upgrades.

MSDTC              Supported during rolling upgrades. However,
                   avoid creating or deleting the MSDTC resource
                   while you are operating as a mixed version
                   cluster. Instead create the MSDTC resource
                   before starting the upgrade on any node, or wait
                   until the upgrade is complete on all nodes. For
                   more information on mixed version clusters, see
                   "How Rolling Upgrades Work" and "Restrictions on
                   Rolling Upgrades" earlier in this text file.

Message Queuing    Microsoft Message Queuing is not fully supported
(also known as     during a rolling upgrade. To upgrade a cluster
MSMQ)              that includes Message Queuing, see "Upgrades
                   That Include Message Queuing Resources" later in
                   this text file.

Network Name       Supported during rolling upgrades.

NNTP Service       NNTP Service Instance is not supported in
Instance           Windows Server 2003, Enterprise Edition.
                   You must remove any NNTP Service Instance
                   resources prior to upgrading.

Physical Disk      Supported during rolling upgrades.

Print Spooler      The only Print Spooler resources supported
                   during a rolling upgrade are those on LPR ports
                   or standard port monitor ports. See the
                   following section, "Upgrades That Include a
                   Print Spooler Resource."

SMTP Service       SMTP Service Instance is not supported in
Instance           Windows Server 2003, Enterprise Edition.
                   You must remove any SMTP Service Instance
                   resources prior to upgrading.

Time Service       Time Service is not supported in Windows
                   Server 2003, Enterprise Edition. You must remove
                   any Time Service resources prior to upgrading.

WINS               WINS is not fully supported during rolling
                   upgrades. You must instead perform a "Last node
                   rolling upgrade" as described in "Alternatives
                   to Rolling Upgrades from Windows 2000" later in
                   this text file.

Other resource     See Relnotes.htm in the \Docs folder of the
types              Setup CD for Windows Server 2003,
                   Enterprise Edition. Also see the product
                   documentation that comes with the application or
                   resource.


You cannot perform a rolling upgrade on a cluster running Windows NT
Server 4.0. Only clusters running Windows 2000 support rolling
upgrades to Windows Server 2003, Enterprise Edition.

When your cluster is in a mixed version state, it is recommended that
you do not make any changes to the cluster configuration, such as
adding or removing nodes. It is also recommended that you do not make
changes to any of the cluster resources while your cluster is in a
mixed version state.


2.3.1  Upgrades That Include a Print Spooler Resource
-----------------------------------------------------
If you want to perform a rolling upgrade of a cluster that has a
Print Spooler resource, you must consider two issues.

First, the Print Spooler resource only supports upgrades (including
rolling upgrades or any other kind of upgrade) of printers
on cluster-supported ports (LPR or Standard Port Monitor ports). For
information about what to do if your printer is not supported, see
"Alternatives to Rolling Upgrades from Windows 2000" later in this
text file.

Second, when you operate a mixed-version cluster including a Print
Spooler resource, note the following:

* Do not change printer settings in a mixed-version cluster with a
  Print Spooler resource.

* Avoid adding new printers while you are performing a rolling
  upgrade. If you do add a new printer, when you install the
  drivers for that printer, be sure to install both the driver for
  Windows 2000 and the driver for Windows Server 2003,
  Enterprise Edition, on all nodes.

* If printing preferences or defaults are important, be sure to
  check them. Printing preferences in Windows Server 2003,
  Enterprise Edition, will not necessarily correspond to document
  defaults for the same printer in Windows 2000. This can be
  affected by differences in the drivers for the two
  operating systems.

When the rolling upgrade is complete and both cluster nodes are
running the updated operating system, you can make any modifications
you choose to your printer configuration.


--------------------------------------------------------
2.4   Alternatives to Rolling Upgrades from Windows 2000
--------------------------------------------------------
Certain resources are not supported during rolling upgrades,
including:

   * Internet Information Services (IIS)
   * DHCP
   * WINS

Special procedures, described in the sections that follow, must be
used when performing an upgrade of a cluster that contains these
resources. In addition to the resource types listed previously, you
might also have other resources that are not supported during rolling
upgrades. Be sure to read Relnotes.htm in the \Docs folder of the
Setup CD for Windows Server 2003, Enterprise Edition, as well as
the product documentation that comes with the application or resource.

   Note: You also cannot perform a rolling upgrade when upgrading from
   Windows NT Server 4.0, Enterprise Edition. For more information,
   see "Upgrading a Cluster from Windows NT Server 4.0 to
   Windows Server 2003, Enterprise Edition," later in this text
   file.


2.4.1  Upgrades That Include an IIS Resource
---------------------------------------------
IIS 6.0 is not supported during rolling upgrades. To upgrade a
clustered IIS resource, you must replace the existing IIS resource
with a Generic Script Resource. You have two options to do this; you
can perform each of the steps as described in the following procedure,
or you can use a script that is supplied with Windows
Server 2003, Enterprise Edition, which automates many of the steps.
The instructions for using the script are described in the
second procedure.

For information about group membership requirements for the following
procedures, see "Group Membership Requirements for Cluster Upgrade
Procedures" earlier in this text file.

>>>TO UPGRADE FROM WINDOWS 2000 WITHOUT USING THE PROVIDED SCRIPT ON A
   CLUSTER THAT INCLUDES AN IIS RESOURCE

   1. Confirm that your hardware is designed for or is compatible with
      Windows Server 2003, Enterprise Edition.

   2. Upgrade all nodes except the node containing the IIS instance
      resource from Windows 2000 to Windows Server 2003,
      Enterprise Edition. You can perform either a rolling upgrade, or
      a nonrolling upgrade, whichever is appropriate for your
      installation. Prior to upgrading, be sure to remove the
      resources that are not supported by Windows Server 2003,
      Enterprise Edition. Do this by using Cluster Administrator and
      clicking the Resource folder in the console tree. In the details
      pane, click the resource that you want to remove, then on the
      File menu, click Delete. For more information, see "Restrictions
      on Rolling Upgrades" earlier in this text file. For general
      information about Setup, see EntSrv4.TXT.

   3. If you do not already have a Distributed Transaction Coordinator
      (DTC) resource on the cluster that you are upgrading, create a
      DTC resource for this cluster on an upgraded node.

         Note: To cluster IIS on Windows Server 2003,
         Enterprise Edition, you must have a DTC resource on that
         cluster as well.

   4. On the Windows 2000 node, note the dependencies of the IIS
      instance resource. Note resources that depend on the IIS
      resource and also note what resources IIS itself is
      dependent on.

   5. Take the group containing the IIS instance resource offline by
      using Cluster Administrator and clicking the Groups folder. In
      the details pane, click the group containing the IIS resource,
      then on the File menu, click Take Offline.

   6. Remove any dependencies on the IIS instance resource by using
      Cluster Administrator and clicking the Resources folder. For
      each resource that is dependent on the IIS instance resource,
      in the details pane, click the resource you want to modify,
      then on the File menu, click Properties. On the Dependencies
      tab, click Modify. Click the IIS resource in the Dependencies
      list and click the left arrow to move it to the Available
      resources list.

   7. Delete the IIS instance resource by using Cluster Administrator
      and clicking the Resource folder in the console tree. In the
      details pane, click the IIS instance resource, then on the File
      menu, click Delete.

   8. Move the group to a node that is running Windows
      Server 2003, Enterprise Edition, and create a Generic Script
      resource by following the procedure documented in "Checklist:
      Creating a clustered IIS Web or FTP service." To find this
      procedure, click Start on an upgraded node (one of the nodes
      running Windows Server 2003, Enterprise Edition),
      click Help and Support, and click Availability and Scalability.
      Click Windows Clustering, click Server Clusters, click
      Checklists: Creating Server Clusters, then click Checklist:
      Creating a clustered IIS Web or FTP service.

      As part of this step, recreate the dependencies of the Generic
      Script resource identical to those of the now deleted IIS
      resource. Make everything that was dependent on the IIS resource
      dependent instead on the Generic Script resource. Also make the
      Generic Script resource dependent on everything that IIS was
      dependent on.

      Only upgraded nodes can be the owner of the Generic Script
      Resource created in this procedure because this resource type is
      not supported in Windows 2000.

   9. Start the W3SVC service on this node and set the W3SVC service
      to start automatically. For more information about the W3SVC,
      see the topic titled "Internet Information Services (IIS)
      security." To find this topic, click Start on the upgraded node,
      click Help and Support, and click Internet Services. Click
      Internet Information Services, then click Internet Information
      Services (IIS) security.

  10. Bring the group containing the new Generic Script resource
      online by using Cluster Administrator and clicking the Groups
      folder. In the details pane, click the group containing the
      Generic Script resource, then on the File menu, click
      Bring Online.

  11. Using IIS, start the Web site on the upgraded node.

  12. Upgrade the final node to Windows Server 2003, Enterprise
      Edition. Manage Your Server will appear when you initially log
      on to the newly upgraded node as an Administrator. Close Manage
      Your Server to continue with the upgrade. Once the upgrade is
      complete, start the W3SVC service on this node and set the W3SVC
      service to start automatically.

         Note: Although suitable for most situations, it is not
         necessary to upgrade all nodes but one in the first step.
         Depending on your availability needs and the number of nodes
         in your cluster, you can modify the sequence of the preceding
         steps by performing steps three through 11 after only one,
         two or three nodes are upgraded. After upgrading between one
         and three nodes, create the Generic Script resource and bring
         it online. Then upgrade the remaining nodes.

>>>TO USE THE PROVIDED SCRIPT TO UPGRADE FROM WINDOWS 2000 ON A
   CLUSTER THAT INCLUDES AN IIS RESOURCE

   1. Confirm that your hardware is designed for or is compatible with
      Windows Server 2003, Enterprise Edition.

   2. Upgrade all nodes except the node containing the IIS instance
      resource from Windows 2000 to Windows Server 2003,
      Enterprise Edition. You can perform either a rolling upgrade, or
      a nonrolling upgrade, whichever is appropriate for your
      installation. Prior to upgrading, be sure to remove the
      resources that are not supported by Windows Server 2003,
      Enterprise Edition. Do this by using Cluster Administrator and
      clicking the Resource folder in the console tree. In the details
      pane, click the resource that you want to remove, then on the
      File menu, click Delete. For more information, see "Restrictions
      on Rolling Upgrades" earlier in this text file. For general
      information about Setup, see EntSrv4.TXT.

   3. If you do not already have a Distributed Transaction Coordinator
      (DTC) resource on the cluster that you are upgrading, create a
      DTC resource for this cluster on an upgraded node.

         Note: To cluster IIS on Windows Server 2003, Enterprise
         Edition, you must have a DTC resource on that cluster
         as well.

   4. On an upgraded node, open a Command Prompt and navigate to the
      %systemroot%\system32\inetsrv directory.

   5. Type:

      iis_switch cluster_name [group_name]

      where

         * cluster_name 
           is the name of a physical node in the cluster that has been
           upgraded or the name of a virtual server.
         * group_name
           is optional, because the script will, by default, upgrade
           all IIS web and FTP resources in the cluster. However, if
           you want to upgrade only one particular group, you can
           specify the name of that resource group.
 
              IMPORTANT: The resource group that includes the IIS
              resource must be on the Windows 2000 node when you run
              the script. The script includes a step that will bring
              the group with the newly created Generic Script resource
              online. However, the script will only bring the group
              online if all resources in the group were online before
              the script was run. If the group was only partially
              online or was offline prior to the script being run,
              the script will take the entire group offline and will
              not bring any resources back online after the upgrade.
              Once the script completes, the newly created resource
              might immediately fail. This is because the W3SVC
              service is disabled. You can correct this problem by
              completing the following step.

   6. Once the script completes, take the newly created Generic Script
      resource offline, then start the W3SVC service on the upgraded
      node and set the W3SVC to start automatically. For more
      information about the W3SVC, see the topic titled "Internet
      Information Services (IIS) security." To find this topic, click
      Start on the upgraded node, click Help and Support, and click
      Internet Services. Click Internet Information Services, then
      click Internet Information Services (IIS) security.

   7. Bring the Generic Script resource online.

   8. Using IIS, start the Web site on the upgraded node.

   9. Upgrade the final node to Windows Server 2003, Enterprise
      Edition. Manage Your Server will appear when you initially log
      on to the newly upgraded node as an Administrator. Close Manage
      Your Server to continue with the upgrade. Once the upgrade is
      complete, start the W3SVC service on this node and set the
      service to start automatically.

  10. If appropriate, add the final upgraded node to the Possible
      Owners list for the newly created Generic Script resource by
      using the Cluster Administrator and clicking the Resource
      folder. In the details pane, click the Generic Script resource.
      On the File menu, click Properties. On the General tab, next to
      Possible owners, click Modify.

      Only upgraded nodes can be the owner of the Generic Script
      Resource created in this procedure because this resource type
      is not supported in Windows 2000.

         Notes: The script will not upgrade IIS resources that are in
         the cluster group. If you have IIS resources that are in the
         cluster group, you can instead use the procedure "To upgrade
         from Windows 2000 without using the provided script on a
         cluster that includes an IIS resource" earlier in this text
         file. The script sets the script path as
         %systemroot%\system32\inetsrv\ by default. You can modify
         this path if necessary.
         Although suitable for most situations, it is not necessary to
         upgrade all nodes but one in the first step. Depending on
         your availability needs and the number of nodes in your
         cluster, you can modify the sequence of the preceding steps
         by performing steps two through four after only one, two or
         three nodes are upgraded. After upgrading between one and
         three nodes, create the Generic Script resource and bring it
         online. Then upgrade the remaining nodes.


2.4.2   Upgrades That Include Message Queuing Resources
-------------------------------------------------------
Microsoft Message Queuing is not fully supported during a
rolling upgrade.

For information about group membership requirements for the following
procedure, see "Group Membership Requirements for Cluster Upgrade
Procedures" earlier in this text file.

>>>TO UPGRADE FROM WINDOWS 2000 ON A CLUSTER THAT CONTAINS MESSAGE
   QUEUING RESOURCES

   1. Confirm that your hardware is designed for or is compatible with
      Windows Server 2003, Enterprise Edition.

   2. Take all of the Message Queuing cluster resources offline by
      using Cluster Administrator and clicking the Resources folder.
      In the details pane, click each Message Queuing resource, then
      on the File menu, click Take Offline.

   3. For each Message Queuing resource, take the Network Name
      resource that depends on it offline also.

   4. Upgrade all of the nodes from Windows 2000 to
      Windows Server 2003, Enterprise Edition. Prior to
      upgrading, be sure to remove the resources that are not
      supported by Windows Server 2003, Enterprise Edition.
      Do this by using Cluster Administrator and clicking the
      Resource folder in the console tree. In the details pane, click
      the resource that you want to remove, then on the File menu,
      click Delete.

   5. Manage Your Server will appear when you initially log on to the
      newly upgraded nodes as an Administrator. Close Manage Your
      Server to continue with the upgrade.

   6. Bring the Network Name resources back online. Ensure that the
      Distributed Transaction Coordinator (DTC) resource is online,
      then bring the Message Queuing resources online.


2.4.3  Last Node Rolling Upgrades
---------------------------------
If you have other resources on your cluster such as DHCP and WINS
that are not fully supported during a rolling upgrade and are not
described by other technology specific procedures listed previously
(such as IIS), you can perform a "last node rolling upgrade."

Last node rolling upgrades are similar to standard rolling upgrades.
In a last node rolling upgrade, you upgrade all nodes except the node
that contains the unsupported resources. After all other nodes are
upgraded, you then upgrade the final node containing the
identified resources.

Last node rolling upgrades are a way to accommodate resources that
cannot fail over to an older operating system from a node running
Windows Server 2003, Enterprise Edition. Be aware that these
resources can, however, fail over the other way, that is, from the
older operating system to Windows Server 2003,
Enterprise Edition.

For information about group membership requirements for the following
procedure, see "Group Membership Requirements for Cluster Upgrade
Procedures" earlier in this text file.

>>>TO PERFORM A LAST NODE ROLLING UPGRADE FROM WINDOWS 2000

   1. Confirm that your systems are running Windows 2000.
 
   2. Confirm that your hardware is designed for or is compatible with
      Windows Server 2003, Enterprise Edition.

   3. Using the information in "Resource Behavior During Rolling
      Upgrades" earlier in this text file, identify the resources in
      your cluster that are not supported by Windows Server 2003,
      Enterprise Edition, and remove those resources. Do this by using
      Cluster Administrator and clicking the Resource folder in the
      console tree. In the details pane, click the resource that you
      want to remove, then on the File menu, click Delete.

   4. Again using the information in "Resource Behavior During Rolling
      Upgrades" earlier in this text file, identify the resources in
      your cluster that are not supported during rolling upgrades and
      are not covered by other technology specific upgrade procedures
      described previously.

   5. Move all of the resources identified in the previous step to a
      single node by double-clicking the Groups folder in the Cluster
      Administrator console tree. Click the group that contains the
      resource and then in the File menu, click Move Group.

   6. Upgrade the operating system on each of the nodes that is not
      hosting the resources moved in the previous step. Manage Your
      Server will appear when you initially log on to the newly
      upgraded nodes as an Administrator. Close Manage Your Server to
      continue with the upgrade.

   7. Move all of the resources that you moved in the earlier steps
      from the node that has not been upgraded to one of the newly
      upgraded nodes.

   8. Once all of the resources have been moved, upgrade the final
      node. After you upgrade, close the Manage Your Server dialog box
      if it is displayed.

         Note: It is not mandatory to move all of these resources to a
         single node and upgrade that node last. However, following
         the procedure as described will typically give you the
         highest availability of the resources that do not support
         rolling upgrades.


======================================================================
3.0   UPGRADING A CLUSTER FROM WINDOWS NT SERVER 4.0 TO
      WINDOWS SERVER 2003, ENTERPRISE EDITION
======================================================================


You cannot perform a rolling upgrade directly from Windows NT
Server 4.0, Enterprise Edition, to Windows Server 2003,
Enterprise Edition. You instead have two options:

   * You can maintain cluster availability by performing an upgrade
     first to Windows 2000, then to Windows Server 2003,
     Enterprise Edition. If you use this method, perform an upgrade
     from Windows NT Server 4.0 to Windows 2000 as documented in the
     Windows 2000 documentation. Then follow the procedures documented
     in "Upgrading a Cluster from Windows 2000 to Windows
     Server 2003, Enterprise Edition," earlier in this text file. If
     you have an IIS resource on your Windows NT Server 4.0 cluster,
     after you complete both upgrades, you must delete the unsupported
     IIS resource type by opening the Command Prompt and typing the
     following command:

     Cluster restype "IIS Virtual Root" /delete /type

   * You can perform a nonrolling upgrade directly from Windows NT
     Server 4.0 to Windows Server 2003, Enterprise Edition, which
     will not allow you to maintain cluster availability.


----------------------------------------------------------------
3.1   Upgrading from Windows NT Server 4.0 while not Maintaining
      Cluster Availability
----------------------------------------------------------------
To upgrade from Windows NT Server 4.0 to Windows Server 2003,
Enterprise Edition, without the use of Windows 2000, you must
interrupt cluster availability. The steps you perform depend on what
resources are included in your cluster. For many installations, the
following procedure, "To upgrade directly from Windows NT Server 4.0
to Windows Server 2003, Enterprise Edition," is appropriate.
However, if your cluster contains an IIS resource, you must use the
procedure "Upgrades from Windows NT Server 4.0 that Include an IIS
Resource" in EntSrv6.TXT. If you have an MSMQ or DTC resource, see
step 2 of the following procedure.

To perform the following procedure, you must be a member of the
Administrators group on the local computer. If the computer is joined
to a domain, members of the Domain Admins group might be able to
perform this procedure.

>>>TO UPGRADE DIRECTLY FROM WINDOWS NT SERVER 4.0 TO WINDOWS
   SERVER 2003, ENTERPRISE EDITION

   1. Confirm that your hardware is designed for or is compatible with
      Windows Server 2003, Enterprise Edition.

   2. Confirm that you do not have an IIS, MSMQ or DTC resource on
      your cluster. If you have an IIS resource, see "Upgrades from
      Windows NT Server 4.0 that Include an IIS Resource" in
      EntSrv6.TXT. If you have an MSMQ or DTC resource, see article
      Q315993, "HOW TO: Upgrade a Windows NT 4.0 Cluster with MSDTC
      and MSMQ Resources" in the Microsoft Knowledge Base. You can
      search the Knowledge Base by going to:
 
         http://support.microsoft.com/

      and then following the instructions on the page.

   3. Ensure that Service Pack 5 or later has been applied to all
      computers that will be upgraded from Windows NT Server 4.0 to
      Windows Server 2003, Enterprise Edition.

   4. As appropriate, notify users that you will be shutting down the
      applications they use on the cluster.

   5. Stop the applications that are made available through the cluster.

   6. Remove any resources that are not supported by
      Windows Server 2003, Enterprise Edition, including
      NNTP Service Instance, SMTP Service Instance and Time Service
      resources. Do this by using Cluster Administrator and clicking
      the Resource folder in the console tree. In the details pane,
      click the resource that you want to remove, then on the File
      menu, click Delete.

   7. Shut down and turn off all nodes but one, or bring them to a
      shutdown state appropriate to your method of termination.

        CAUTION: If you are using a shared storage device, when you
        upgrade and power on and start the operating system, it is of
        vital importance that only one node has access to the cluster
        disk. Otherwise the cluster disks can become corrupted. To
        prevent the corruption of the cluster disks, shut down all
        but one cluster node, or use other techniques (for example,
        LUN masking, selective presentation, or zoning) to protect
        the cluster disks, before creating the cluster. Once the
        Cluster service is running properly on one node, the other
        nodes can be installed and configured simultaneously.

   8. Upgrade the operating system on the node that is running. For
      general information about Setup, review appropriate sections in
      EntSrv1.TXT, EntSrv2.TXT, EntSrv3.TXT, and EntSrv4.TXT.

      The cluster software will be upgraded automatically during the
      operating system upgrade. Note that you cannot make
      configuration changes such as configuring cluster disks as
      dynamic disks. For more information, see "Limitations of server
      clusters" in Help and Support Center for
      Windows Server 2003, Enterprise Edition. To open Help
      and Support Center, after completing Setup, click Start, and
      then click Help and Support. You can also view Help and Support
      Center topics on the Web at:

         http://www.microsoft.com/windowsserver2003/proddoc/

      Note: When upgrading from Windows NT Server 4.0 to
      Windows Server 2003, Enterprise Edition, the Cluster
      service user account requires the additional user right
      "Act as part of the operating system." If possible, Setup
      will grant this user right automatically. If Setup cannot
      grant the user right, you will be prompted to make this
      change. For security reasons, you must grant this user right
      to the specific user account that is used by the Cluster
      service. You cannot correct this problem by granting the user
      right to a security group of which the user account is a
      member. Typically, you must grant this user right as a local
      user right; it cannot be a domain-level user right. However,
      if your node is a domain controller, you can use the domain
      level user right. For more information on setting user
      rights, on Windows NT Server 4.0, open User Manager for
      Domains, click the Help menu in User Manager and refer to
      "Managing the User Rights Policy."

      Manage Your Server will appear when you initially log on to the
      newly upgraded node as an Administrator. Close Manage Your
      Server to continue with the upgrade.

   9. On the upgraded node, click Start, point to Programs, point to
      Administrative Tools, and then click Cluster Administrator.

  10. Check to see that the cluster disks are online in
      Cluster Administrator.

         CAUTION: Be sure that the cluster disks are online in Cluster
         Administrator before continuing to the next step. Otherwise
         the cluster storage could be corrupted.

  11. Shut down and turn off the upgraded node, or bring it to a
      shutdown state appropriate to your method of termination.

  12. Turn on the other node in the cluster and upgrade the operating
      system on that node.

      Manage Your Server will appear when you initially log on to the
      newly upgraded node as an Administrator. Close Manage Your
      Server to continue with the upgrade.

  13. After the second node is upgraded, turn on the first node.
 
  14. If you want to add additional nodes to the cluster, add them
      after the first two nodes are upgraded.

         IMPORTANT: If your goal is to have more than two nodes in
         the cluster, you must use Fibre Channel (not SCSI) for the
         cluster storage.

(additional Setup information in EntSrv6.txt)

Information in this document, including URL and other Internet
Web site references, is subject to change without notice.
Unless otherwise noted, the example companies, organizations,
products, domain names, e-mail addresses, logos, people, places
and events depicted herein are fictitious, and no association
with any real company, organization, product, domain name,
e-mail address, logo, person, place or event is intended or
should be inferred. Complying with all applicable copyright laws
is the responsibility of the user. Without limiting the rights
under copyright, no part of this document may be reproduced,
stored in or introduced into a retrieval system, or transmitted
in any form or by any means (electronic, mechanical, photocopying,
recording, or otherwise), or for any purpose, without the express
written permission of Microsoft Corporation.

Microsoft may have patents, patent applications, trademarks,
copyrights, or other intellectual property rights covering subject
matter in this document.  Except as expressly provided in any
written license agreement from Microsoft, the furnishing of this
document does not give you any license to these patents, trademarks,
copyrights, or other intellectual property.

(c) 2002-2003 Microsoft Corporation.  All rights reserved.

The names of actual companies and products mentioned herein may
be the trademarks of their respective owners.