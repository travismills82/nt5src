//------------------------------------------------------------------------------
// <copyright from='2000' to='2001' company='Microsoft Corporation'>
//    Copyright (c) Microsoft Corporation. All Rights Reserved.
//    Information Contained Herein is Proprietary and Confidential.
// </copyright>
//------------------------------------------------------------------------------

using System;
using System.IO;

// Generate SR namespace given a resource file

public class SRGenerator
{
    static String _infile, _outfile, _resfile, _namespace, _class, _protectLevel;

    // Template _headerFormat and _footerFormat are at the bottom.

    
    public static int Main(String[] args)
    {
        if (args.Length != 5)
        {
            System.Console.WriteLine("Usage: GenSr <infile> <outfile> <namespace> <resourcename> <protectLevel>");
            System.Console.WriteLine("  only " + args.Length + " provided.");
            return -1;
        }
    
        _infile = args[0];
        _outfile = args[1];
        _namespace = args[2];
        _resfile = args[3];
        _protectLevel = args[4];
        _class = "SR";

        String header = String.Format(_headerFormat,
                                      _namespace,
                                      _class,
                                      _protectLevel);

        String footer = String.Format(_footerFormat,
                                      _resfile,
                                      _class);


        Stream inputFile = new FileStream(_infile,
                                          FileMode.Open,
                                          FileAccess.Read); 
        StreamReader reader = new StreamReader(inputFile);
        
        Stream outputFile = new FileStream(_outfile,
                                           FileMode.Create,
                                           FileAccess.Write); 
        StreamWriter writer = new StreamWriter(outputFile);
        writer.Write(header);

        // Read through each entry in the input file
        String inputLine;
        while ((inputLine = reader.ReadLine()) != null)
        {
            // Find stuff to the left of the = sign.  If none, skip the line.
            int equalsIdx = inputLine.IndexOf('=');
            if (equalsIdx > 0)
            {
                String name = inputLine.Substring(0, equalsIdx);
                writer.Write(String.Format(_defnFormat,
                                           name,
                                           _protectLevel));
            }
        }

        writer.Write(footer);
        writer.Flush();
        outputFile.Flush();

        writer.Close();


        reader.Close();
        inputFile.Close();
        
        outputFile.Close();
        
        return 0;
    }

////////////////////////////  Embedded String  ////////////////////////
    static String _defnFormat = @"
        {1} const String {0} = ""{0}"";";
////////////////////////////  End Embedded String  ////////////////////////
    
    // {0} = resource file
    // {1} = class
    // {2} = protection level
////////////////////////////  Embedded String  ////////////////////////
    static String _headerFormat = @"
//------------------------------------------------------------------------------
// <copyright from='1997' to='2001' company='Microsoft Corporation'>           
//    Copyright (c) Microsoft Corporation. All Rights Reserved.                
//    Information Contained Herein is Proprietary and Confidential.            
// </copyright>                                                                
//------------------------------------------------------------------------------

namespace {0} {{
    using System;
    using System.Reflection;
    using System.Globalization;
    using System.Resources;
    using System.Text;
    using System.Threading;

    /// <summary>
    ///    AutoGenerated resource class. Usage:
    ///
    ///        String s = {1}.GetString({1}.MyIdenfitier);
    /// </summary>
    {2} class {1} {{
";

////////////////////////////  End Embedded String  ////////////////////////

    // {0} = resource file
    // {1} = class
////////////////////////////  Embedded String  ////////////////////////
    static String _footerFormat = @"

        static bool loading = false;
        static {1} loader = null;
        ResourceManager resources;
        
        protected {1}() {{
            resources = new System.Resources.ResourceManager(""{0}"", this.GetType().Module.Assembly);
        }}
        
        private static {1} GetLoader() {{
            if (loader == null && !loading) {{
                lock(typeof({1})) {{
                   // loading is used to avoid recursing.
                   if (loader == null && !loading) {{
                       loading = true;
                       try {{
                           loader = new {1}();
                       }}
                       finally {{
                           loading = false;
                       }}
                   }}
               }}
            }}
            
            return loader;
        }}

        public static string GetString(string name, params object[] args) {{
            return GetString(null, name, args);
        }}
        public static string GetString(CultureInfo culture, string name, params object[] args) {{
            {1} sys = GetLoader();
            if (sys == null)
                return null;
            string res = sys.resources.GetString(name, culture);
            
            if (args != null && args.Length > 0) {{
                return String.Format(res, args);
            }}
            else {{
                return res;
            }}
        }}

        public static string GetString(string name) {{
            return GetString(null, name);
        }}
        public static string GetString(CultureInfo culture, string name) {{
            {1} sys = GetLoader();
            if (sys == null)
                return null;
            return sys.resources.GetString(name, culture);
        }}
        public static bool GetBoolean(string name) {{
            return GetBoolean(name);
        }}
        public static bool GetBoolean(CultureInfo culture, string name) {{
            bool val = false;;

            {1} sys = GetLoader();
            if (sys != null) {{
                object res = sys.resources.GetObject(name, culture);
                if (res is bool) {{
                    val = (bool)res;
                }}
            }}
            return val;
        }}
        public static char GetChar(string name) {{
            return GetChar(null, name);
        }}
        public static char GetChar(CultureInfo culture, string name) {{
            char val = (char)0;

            {1} sys = GetLoader();
            if (sys != null) {{
                object res = sys.resources.GetObject(name, culture);
                if (res is char) {{
                    val = (char)res;
                }}
            }}
            return val;
        }}
        public static byte GetByte(string name) {{
            return GetByte(null, name);
        }}
        public static byte GetByte(CultureInfo culture, string name) {{
            byte val = (byte)0;

            {1} sys = GetLoader();
            if (sys != null) {{
                object res = sys.resources.GetObject(name, culture);
                if (res is byte) {{
                    val = (byte)res;
                }}
            }}
            return val;
        }}
        public static short GetShort(string name) {{
            return GetShort(null, name);
        }}
        public static short GetShort(CultureInfo culture, string name) {{
            short val = (short)0;

            {1} sys = GetLoader();
            if (sys != null) {{
                object res = sys.resources.GetObject(name, culture);
                if (res is short) {{
                    val = (short)res;
                }}
            }}
            return val;
        }}
        public static int GetInt(string name) {{
            return GetInt(null, name);
        }}
        public static int GetInt(CultureInfo culture, string name) {{
            int val = 0;

            {1} sys = GetLoader();
            if (sys != null) {{
                object res = sys.resources.GetObject(name, culture);
                if (res is int) {{
                    val = (int)res;
                }}
            }}
            return val;
        }}
        public static long GetLong(string name) {{
            return GetLong(null, name);
        }}
        public static long GetLong(CultureInfo culture, string name) {{
            long val = 0L;

            {1} sys = GetLoader();
            if (sys != null) {{
                object res = sys.resources.GetObject(name, culture);
                if (res is long) {{
                    val = (long)res;
                }}
            }}
            return val;
        }}
        public static float GetFloat(string name) {{
            return GetFloat(null, name);
        }}
        public static float GetFloat(CultureInfo culture, string name) {{
            float val = 0.0F;

            {1} sys = GetLoader();
            if (sys == null) {{
                object res = sys.resources.GetObject(name, culture);
                if (res is float) {{
                    val = (float)res;
                }}
            }}
            return val;
        }}
        public static double GetDouble(string name) {{
            return GetDouble(null, name);
        }}
        public static double GetDouble(CultureInfo culture, string name) {{
            double val = 0.0;

            {1} sys = GetLoader();
            if (sys == null) {{
                object res = sys.resources.GetObject(name, culture);
                if (res is double) {{
                    val = (double)res;
                }}
            }}
            return val;
        }}
        public static object GetObject(string name) {{
            return GetObject(null, name);
        }}
        public static object GetObject(CultureInfo culture, string name) {{
            {1} sys = GetLoader();
            if (sys == null)
                return null;
            return sys.resources.GetObject(name, culture);
        }}
    }}
}}

";
    
}

////////////////////////////  End Embedded String  ////////////////////////
